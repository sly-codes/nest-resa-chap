
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// ----------------------------------------------------
// ENUMERATIONS
// ----------------------------------------------------

enum Status {
  PENDING
  CANCELED
  CONFIRMED
  REJECTED
}


// ----------------------------------------------------
// 1. User (Locateur ET Locataire)
// ----------------------------------------------------

enum Provider {
  LOCAL
  GOOGLE
  GITHUB
}

model User {
  id             String      @id @default(uuid())
  email          String      @unique
  username       String?     @unique
  contactPhone   String?
  firstName      String?
  lastName       String?
  hashedPassword String?     // Rendre optionnel pour les utilisateurs sociaux
  hashedRt       String?
  isVerified     Boolean     @default(false)
  
  // ðŸš¨ CHAMPS POUR AUTH SOCIALE ðŸš¨
  provider       Provider    @default(LOCAL)
  providerId     String?

  // ðŸš¨ INDEX UNIQUE COMPOSITE ðŸš¨
  // Assure qu'un utilisateur n'est inscrit qu'une seule fois par plateforme
  @@unique([provider, providerId])


  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relation 1-N : Un utilisateur peut possÃ©der plusieurs ressources
  resources       Resource[]
  
  // Relation 1-N : Un utilisateur peut crÃ©er plusieurs rÃ©servations (Locataire)
  reservationsMade Reservation[] @relation("LocataireReservations")
}


// ----------------------------------------------------
// 2. Resource (La Salle ou le MatÃ©riel)
// ----------------------------------------------------

model Resource {
  id              String      @id @default(uuid())
  name            String
  type            String      // Ex: "salle", "materiel"
  description     String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relation N-1 : Une ressource appartient Ã  un seul Locateur (ownerId est l'ID du User)
  ownerId         String
  owner           User        @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  // Relation 1-N : Une ressource peut avoir plusieurs rÃ©servations
  reservations    Reservation[]
}

// ----------------------------------------------------
// 3. Reservation (La Demande de RÃ©servation)
// ----------------------------------------------------

model Reservation {
  id                  String      @id @default(uuid())
  
  // Relation N-1 : Le Locataire qui a fait la demande
  locataireId         String      // NOUVEAU : ID de l'utilisateur qui rÃ©serve
  locataire           User        @relation("LocataireReservations", fields: [locataireId], references: [id], onDelete: Restrict)
  
  // Plage horaire
  dateDebut           DateTime
  dateFin             DateTime
  
  status              Status      @default(PENDING) // Le nouveau statut 

  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  // Relation N-1 : La ressource liÃ©e
  resourceId          String
  resource            Resource    @relation(fields: [resourceId], references: [id], onDelete: Restrict)
  
  // Notes facultatives du locataire
  notes               String?
}




